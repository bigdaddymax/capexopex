<script>
    
    $(function(){
        $("#approve").button()
        .click(function(){
            $.post("<?php echo $this->url(array('controller' => 'form', 'action' => 'approve'), null, true); ?>", {'formId': <?php echo $this->form['form']->formId; ?>});
        });
        
        $("#decline").button()
        .click(function(){
            $.post("<?php echo $this->url(array('controller' => 'form', 'action' => 'decline'), null, true); ?>", {'formId': <?php echo $this->form['form']->formId; ?>});
        });
        
        $("#publish").button()
        .click(function(){
            $.post("<?php echo $this->url(array('controller' => 'form', 'action' => 'publish-form'), null, true); ?>",
            {formId: <?php echo $this->form['form']->formId; ?>},
            function(data){
                if (1 == data.error){
                    alert(data.message);
                } else {
                    window.location = "<?php echo $this->url(array('controller' => 'form', 'action' => 'index'), null, true); ?>";
                }
            });
        });
        
        $("#edit").button().click(function(){
            window.location = "<?php echo $this->url(array('controller' => 'form', 'action' => 'edit-form', 'formId' => $this->form['form']->formId), null, true); ?>";
        });
    });
    
</script> 

<div id="form-data">
    <div id="form-header">
        <?php
        echo $this->form['form']->formName;
        ?>
    </div>
    <div id="form-approvals">
        <?php
        if (isset($this->approved)) {
            foreach ($this->approved as $approver) {
                echo '<tr><td>' . $approver['userName'] . '</td><td>' . $approver['decision'] . '</td></tr>';
            }
        }
        ?>

    </div>

    <div id="form-details">
        <?php
        echo '<div id = "form-date">' . $this->form['form']->date . '</div>';
        if (!empty($this->form['parentNode']->nodeName))
            echo '<div id = "form-node">' . $this->form['parentNode']->nodeName .'</div>';
        echo '<div id = "form-node">' . $this->form['node']->nodeName . '</div>';
        echo '<div id = "form-user">' . $this->form['owner']->userName . '</div>';
        ?>

    </div>
    <div id="form-descr">

    </div>
    <div id="items">
        <?php
        foreach ($this->form['items'] as $item) {
            echo '<div id="item-name">' . $item->itemName . '</div><div id="item-value">' . sprintf("%01.2f", $item->value) . '</div><div id = "item-element">' . $item->element->elementName . ' </div>' . PHP_EOL;
        }
        ?>
        <?php echo '<div id="items-total">' . $this->translate('total') . '</div>'; ?>
        <?php echo '<div id="items-total-amount">' . sprintf("%01.2f", $this->form['total']) . '</div>'; ?>   </div>
    <div id="attachments">


    </div>
    <div id="form-buttons">
        <?php
        if ($this->showApproval && $this->form['form']->public) {
            echo '<button id="approve" name="approve">' . $this->translate('approve') . '</button>';
            echo '<button id="decline" name="decline">' . $this->translate('decline') . '</button>';
        }

        if (!$this->form['form']->public) {
            echo '<button id="publish">' . $this->translate('publish') . '</button>';
            echo '<button id="edit">' . $this->translate('edit form') . '</button>';
        }
        ?>
    </div>
    <div id="comments">

    </div>

</div>

<table>
    <?php
    if (isset($this->approved)) {
        foreach ($this->approved as $approver) {
            echo '<tr><td>' . $approver['userName'] . '</td><td>' . $approver['decision'] . '</td></tr>';
        }
    }
    ?>
</table>
<table>
    <tr><td><?php echo $this->form['form']->formName; ?></td></tr>
    <tr><td><?php echo $this->form['form']->date; ?></td></tr>
    <tr><td><?php if (!empty($this->form['parentNode']->nodeName)) echo $this->form['parentNode']->nodeName; ?></td></tr>
    <tr><td><?php echo $this->form['node']->nodeName; ?></td></tr>
    <tr><td><?php echo $this->form['owner']->userName; ?></td></tr>
</table>
<table>
    <?php
    foreach ($this->form['items'] as $item) {
        echo '<tr><td>' . $item->itemName . '</td><td>' . sprintf("%01.2f", $item->value) . '</td><td>' . $item->element->elementName . ' </td></tr>' . PHP_EOL;
    }
    ?>
    <tr><td><?php echo $this->translate('total'); ?></td><td><?php echo sprintf("%01.2f", $this->form['total']); ?></td><td></td></tr>
</table>
<?php
if ($this->showApproval && $this->form['form']->public) {
    echo '<button id="approve" name="approve">' . $this->translate('approve') . '</button>';
    echo '<button id="decline" name="decline">' . $this->translate('decline') . '</button>';
}

if (!$this->form['form']->public) {
    echo '<button id="publish">' . $this->translate('publish') . '</button>';
    echo '<button id="edit">' . $this->translate('edit form') . '</button>';
}
